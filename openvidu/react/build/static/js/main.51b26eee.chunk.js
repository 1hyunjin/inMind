(this["webpackJsonpopenvidu-react"]=this["webpackJsonpopenvidu-react"]||[]).push([[0],{111:function(e,s,t){},113:function(e,s,t){},114:function(e,s,t){"use strict";t.r(s);var i=t(4),n=t.n(i),a=t(53),o=t.n(a),r=(t(59),t(54)),c=t(23),d=t.n(c),h=(t(111),t(0));class l extends i.Component{constructor(e){super(e),this.videoRef=n.a.createRef()}componentDidUpdate(e){e&&this.videoRef&&this.props.streamManager.addVideoElement(this.videoRef.current)}componentDidMount(){this.props&&this.videoRef&&this.props.streamManager.addVideoElement(this.videoRef.current)}render(){return Object(h.jsx)("video",{autoPlay:!0,ref:this.videoRef})}}t(113);class m extends i.Component{getNicknameTag(){return JSON.parse(this.props.streamManager.stream.connection.data).clientData}render(){return Object(h.jsx)("div",{children:void 0!==this.props.streamManager?Object(h.jsxs)("div",{className:"streamcomponent",children:[Object(h.jsx)(l,{streamManager:this.props.streamManager}),Object(h.jsx)("div",{children:Object(h.jsx)("p",{children:this.getNicknameTag()})})]}):null})}}class u extends i.Component{constructor(e){super(e),this.state={mySessionId:"SessionA",myUserName:"Participant"+Math.floor(100*Math.random()),session:void 0,mainStreamManager:void 0,publisher:void 0,subscribers:[]},this.joinSession=this.joinSession.bind(this),this.leaveSession=this.leaveSession.bind(this),this.switchCamera=this.switchCamera.bind(this),this.handleChangeSessionId=this.handleChangeSessionId.bind(this),this.handleChangeUserName=this.handleChangeUserName.bind(this),this.handleMainVideoStream=this.handleMainVideoStream.bind(this),this.onbeforeunload=this.onbeforeunload.bind(this)}componentDidMount(){window.addEventListener("beforeunload",this.onbeforeunload)}componentWillUnmount(){window.removeEventListener("beforeunload",this.onbeforeunload)}onbeforeunload(e){this.leaveSession()}handleChangeSessionId(e){this.setState({mySessionId:e.target.value})}handleChangeUserName(e){this.setState({myUserName:e.target.value})}handleMainVideoStream(e){this.state.mainStreamManager!==e&&this.setState({mainStreamManager:e})}deleteSubscriber(e){let s=this.state.subscribers,t=s.indexOf(e,0);t>-1&&(s.splice(t,1),this.setState({subscribers:s}))}joinSession(){this.OV=new r.OpenVidu,this.setState({session:this.OV.initSession()},(()=>{var e=this.state.session;e.on("streamCreated",(s=>{var t=e.subscribe(s.stream,void 0),i=this.state.subscribers;i.push(t),this.setState({subscribers:i})})),e.on("streamDestroyed",(e=>{this.deleteSubscriber(e.stream.streamManager)})),e.on("exception",(e=>{console.warn(e)})),this.getToken().then((s=>{e.connect(s,{clientData:this.state.myUserName}).then((async()=>{let s=await this.OV.initPublisherAsync(void 0,{audioSource:void 0,videoSource:void 0,publishAudio:!0,publishVideo:!0,resolution:"640x480",frameRate:30,insertMode:"APPEND",mirror:!1});e.publish(s);var t=(await this.OV.getDevices()).filter((e=>"videoinput"===e.kind)),i=s.stream.getMediaStream().getVideoTracks()[0].getSettings().deviceId,n=t.find((e=>e.deviceId===i));this.setState({currentVideoDevice:n,mainStreamManager:s,publisher:s})})).catch((e=>{console.log("There was an error connecting to the session:",e.code,e.message)}))}))}))}leaveSession(){const e=this.state.session;e&&e.disconnect(),this.OV=null,this.setState({session:void 0,subscribers:[],mySessionId:"SessionA",myUserName:"Participant"+Math.floor(100*Math.random()),mainStreamManager:void 0,publisher:void 0})}async switchCamera(){try{var e=(await this.OV.getDevices()).filter((e=>"videoinput"===e.kind));if(e&&e.length>1){var s=e.filter((e=>e.deviceId!==this.state.currentVideoDevice.deviceId));if(s.length>0){var t=this.OV.initPublisher(void 0,{videoSource:s[0].deviceId,publishAudio:!0,publishVideo:!0,mirror:!0});await this.state.session.unpublish(this.state.mainStreamManager),await this.state.session.publish(t),this.setState({currentVideoDevice:s[0],mainStreamManager:t,publisher:t})}}}catch(i){console.error(i)}}render(){const e=this.state.mySessionId,s=this.state.myUserName;return Object(h.jsxs)("div",{className:"container",children:[void 0===this.state.session?Object(h.jsxs)("div",{id:"join",children:[Object(h.jsx)("div",{id:"img-div",children:Object(h.jsx)("img",{src:"resources/images/openvidu_grey_bg_transp_cropped.png",alt:"OpenVidu logo"})}),Object(h.jsxs)("div",{id:"join-dialog",className:"jumbotron vertical-center",children:[Object(h.jsx)("h1",{children:" Join a video session "}),Object(h.jsxs)("form",{className:"form-group",onSubmit:this.joinSession,children:[Object(h.jsxs)("p",{children:[Object(h.jsx)("label",{children:"Participant: "}),Object(h.jsx)("input",{className:"form-control",type:"text",id:"userName",value:s,onChange:this.handleChangeUserName,required:!0})]}),Object(h.jsxs)("p",{children:[Object(h.jsx)("label",{children:" Session: "}),Object(h.jsx)("input",{className:"form-control",type:"text",id:"sessionId",value:e,onChange:this.handleChangeSessionId,required:!0})]}),Object(h.jsx)("p",{className:"text-center",children:Object(h.jsx)("input",{className:"btn btn-lg btn-success",name:"commit",type:"submit",value:"JOIN"})})]})]})]}):null,void 0!==this.state.session?Object(h.jsxs)("div",{id:"session",children:[Object(h.jsxs)("div",{id:"session-header",children:[Object(h.jsx)("h1",{id:"session-title",children:e}),Object(h.jsx)("input",{className:"btn btn-large btn-danger",type:"button",id:"buttonLeaveSession",onClick:this.leaveSession,value:"Leave session"}),Object(h.jsx)("input",{className:"btn btn-large btn-success",type:"button",id:"buttonSwitchCamera",onClick:this.switchCamera,value:"Switch Camera"})]}),void 0!==this.state.mainStreamManager?Object(h.jsx)("div",{id:"main-video",className:"col-md-6",children:Object(h.jsx)(m,{streamManager:this.state.mainStreamManager})}):null,Object(h.jsxs)("div",{id:"video-container",className:"col-md-6",children:[void 0!==this.state.publisher?Object(h.jsx)("div",{className:"stream-container col-md-6 col-xs-6",onClick:()=>this.handleMainVideoStream(this.state.publisher),children:Object(h.jsx)(m,{streamManager:this.state.publisher})}):null,this.state.subscribers.map(((e,s)=>Object(h.jsxs)("div",{className:"stream-container col-md-6 col-xs-6",onClick:()=>this.handleMainVideoStream(e),children:[Object(h.jsx)("span",{children:e.id}),Object(h.jsx)(m,{streamManager:e})]},e.id)))]})]}):null]})}async getToken(){const e=await this.createSession(this.state.mySessionId);return await this.createToken(e)}async createSession(e){const s=await d.a.post("openvidu/api/sessions",{customSessionId:e},{headers:{"Content-Type":"application/json",Authorization:"Basic T1BFTlZJRFVBUFA6c3NhZnk="}});return console.log(e),console.log(s.data),s.data}async createToken(e){console.log(e);const s=await d.a.post("openvidu/api/sessions/"+e.sessionId+"/connection",{},{headers:{"Content-Type":"application/json",Authorization:"Basic T1BFTlZJRFVBUFA6c3NhZnk="}});return console.log(s.data),s.data.token}}var b=u;const v=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function p(e){navigator.serviceWorker.register(e).then((e=>{e.onupdatefound=()=>{const s=e.installing;s.onstatechange=()=>{"installed"===s.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((e=>{console.error("Error during service worker registration:",e)}))}o.a.render(Object(h.jsx)(b,{}),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",(()=>{const e="".concat("","/service-worker.js");v?(!function(e){fetch(e).then((s=>{404===s.status||-1===s.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((e=>{e.unregister().then((()=>{window.location.reload()}))})):p(e)})).catch((()=>{console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((()=>{console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):p(e)}))}}()},59:function(e,s,t){}},[[114,1,2]]]);
//# sourceMappingURL=main.51b26eee.chunk.js.map